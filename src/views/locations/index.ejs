<% for(let i = 0; i < locations.length; i++) { %>
    <div class="grid-item thumbnail col col-xs-12 col-sm-12 col-md-6 col-lg-4">
        <div class="caption">
            <h5><a href="<%= locations[i]._id %>"><%= locations[i].name %></a></h5>
            <h5><%= locations[i].date.toDateString() %></h5>
            <p><%= locations[i].description %></p>
        </div>

        <img class="img-responsive" src="<%= locations[i].images[0] %>" alt="<%= locations[i].name %> Cover Image"</img>

        <button class="btn alert-info upLike" type="button" class="btn btn-default" data-toggle="button" aria-pressed="false"><span class="glyphicon glyphicon-thumbs-up"></span> Like</button>

        <span id="<%= locations[i]._id %>" class="btn btn-default likes" disabled="disabled"><%= locations[i].likes %></span>
    </div>
<% } %>

<script>
    // setInterval(function() {
    //     updateLikes();
    // }, (10 * 1000));

    $('.upLike').on('click', function() {
        let id = $(this).siblings('span')[0].id;
        let setUrl = "http://localhost:3000/api/chapters/" + id + "?key=" + "<%= masterKey.key %>";

        $.ajax({
            method: "PUT",
            url: setUrl,
            data: {
                $inc: {
                    likes: 1
                }
            }
        })
        .done(function() {
            //updateLikes();
        });
    });

    function updateLikes() {
        $.get('http://localhost:3000/api/chapters', function(data) {
            <% for(let i = 0; i < locations.length; i++) { %>
                var location = "<%= locations[i]._id %>";
                $('#' + location).text(data.likes);
            <% } %>
        });
    }

    updateLikes();
</script>
